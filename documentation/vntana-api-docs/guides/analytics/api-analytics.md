# API Analytics

> **Source URL:** https://help.vntana.com/api-analytics

## Overview

When you publish your 3D to the VNTANA Platform and share it externally, we will keep track of a few handy metrics for you. These include 3D views, AR views, and user interaction (interaction within the viewer itself), and through the Admin API this information can be obtained and easily integrated into your own systems. The data can be filtered by a date interval and categorized by device type of users, and a domain can be added to your individual Assets to allow for the retrieval of the metrics generated by a specific domain.

**API Base URL:** `https://api-platform.vntana.com`

> **Note:** In the following guide and API documentation, you will see referenced in numerous endpoints something called a "Client". This refers to the workspaces one can create on the Platform within an Organization. The Client nomenclature is a legacy reference being replaced with Workspace.

## Authentication

As with all usage of the Admin API, you must first generate a valid refresh token. This refresh token will be used by each endpoint to indicate the Organization the data should be pulled from.

**Authentication Steps Summary:**

1. **Log in** using an Authentication Key or email/password. Returns an `x-auth-token` in the Response Headers.
2. **Retrieve organizations** and store the needed Organization's UUID. Pass the `x-auth-token` from Step 1 in the Request Headers.
3. **Generate Organization Refresh Token**. Pass the `x-auth-token` from Step 1 in the Request Headers with `organizationUuid`. Returns the Refresh Token as the Response Header `x-auth-token`.
4. **Retrieve workspaces** and store the needed UUID. Pass the `x-auth-token` in the Request Headers.
5. **Generate Workspace Refresh Token** (Organization Admin/Owner users must skip this step). Pass the Refresh Token from Step 3 in the Request Headers with the Organization and Workspace UUIDs. Returns the Refresh Token as the Response Header `x-auth-token`.

See [API Authentication](../authentication/api-authentication.md) for detailed instructions.

## Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/v2/metrics/dashboard` | Get metrics dashboard overview |
| POST | `/v2/metrics/views-data` | Get 3D or AR views breakdown |
| POST | `/v2/metrics/summary-report` | Generate summary report (Excel) |

## Retrieving Metrics Dashboard

For a single Organization, this endpoint returns totals for 3D views, AR views, and user engagement, as well as the individual metrics and asset details of the most viewed asset during the indicated date interval.

**Endpoint:** `POST /v2/metrics/dashboard`

**Headers:**
```
x-auth-token: Bearer {refreshToken}
```

**Request Body:**
```json
{
  "startDate": "2023-06-01T00:00:00",
  "endDate": "2023-07-01T23:59:59",
  "clientUuids": ["string"],
  "productsUuid": ["string"],
  "domain": "vntana.com"
}
```

### Request Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `startDate` | string | Timestamp indicating the earliest date to grab metrics from |
| `endDate` | string | Timestamp indicating the latest date to grab metrics from |
| `clientUuids` | string[] | List of Workspace UUIDs to include. Pass `null` to include all. |
| `productsUuid` | string[] | List of Asset UUIDs to include. Pass `null` to include all. |
| `domain` | string | The domain where the 3D viewers are embedded. Must be included in the embed code/share link. Pass `null` to include all. |

### Response Fields

| Field | Description |
|-------|-------------|
| `total3DViews` | Total 3D view count |
| `totalARViews` | Total AR view count |
| `userEngagement` | User engagement count |
| `avgNumberInteractions` | Average number of interactions |
| `mostViewedProduct` | Details of the most viewed product including all optimized formats |

## Retrieving 3D or AR Views Data

Get a breakdown of 3D or AR view data filtered by various parameters.

**Endpoint:** `POST /v2/metrics/views-data`

**Headers:**
```
x-auth-token: Bearer {refreshToken}
```

**Request Body:**
```json
{
  "viewType": "3DView",
  "actionTypes": ["view"],
  "returnFields": ["device"],
  "startDate": "2022-12-01T00:00:00",
  "endDate": "2023-01-17T23:59:59",
  "dateInterval": "WEEK",
  "clientUuids": ["string"],
  "productsUuid": ["string"],
  "domain": null
}
```

### Request Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `viewType` | string | `3DView` or `ARView` |
| `actionTypes` | string[] | For 3DView use `["view"]`, for ARView use `["click", "scan"]` |
| `returnFields` | string[] | Pass `["device"]` to include device type in response |
| `startDate` | string | Timestamp for earliest date |
| `endDate` | string | Timestamp for latest date |
| `dateInterval` | string | `DAY`, `WEEK`, or `MONTH` |
| `clientUuids` | string[] | Workspace UUIDs to filter. Pass `null` for all. |
| `productsUuid` | string[] | Asset UUIDs to filter. Pass `null` for all. |
| `domain` | string | Domain to filter by. Pass `null` for all. |

### Response Example

```json
{
  "success": true,
  "errors": [],
  "response": {
    "count": 21,
    "grid": [
      {
        "deviceCategory": "desktop",
        "dateInterval": "20230627",
        "count": 9
      },
      {
        "deviceCategory": "desktop",
        "dateInterval": "20230605",
        "count": 51
      }
    ]
  }
}
```

### Response Fields

| Field | Description |
|-------|-------------|
| `count` | Number of recorded 3D or AR views |
| `dateInterval` | Condensed timestamp based on interval type (see below) |
| `deviceCategory` | `desktop`, `mobile`, or `tablet` |

**Date Interval Formats:**

| Interval | Format | Example | Meaning |
|----------|--------|---------|---------|
| DAY | `YYYYMMDD` | `20230605` | June 5th, 2023 |
| WEEK | `YYYYww` | `202322` | 22nd week of 2023 |
| MONTH | `YYYYMM` | `202306` | June 2023 |

## Retrieving a Summary Report

Generate a summary report containing all applicable Assets and their individual 3D, AR, and user engagement metrics broken down by device type. The response is a base64 encoded string that can be decoded and stored as an Excel sheet.

**Endpoint:** `POST /v2/metrics/summary-report`

**Headers:**
```
x-auth-token: Bearer {refreshToken}
```

**Request Body:**
```json
{
  "startDate": "2022-11-01",
  "endDate": "2022-12-31",
  "clientUuids": ["string"],
  "productUuids": ["string"],
  "domain": "string"
}
```

### Response Example

```json
{
  "success": true,
  "errors": [],
  "response": {
    "document": "base64 encoded string",
    "contentType": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
  }
}
```

The `document` field contains the report as a base64 string representation of the Excel data. Decode this string and save as `.xlsx` to open in Excel.

## Code Examples

### Get Metrics Dashboard

```bash
curl -X POST "https://api-platform.vntana.com/v2/metrics/dashboard" \
  -H "Content-Type: application/json" \
  -H "x-auth-token: Bearer your-refresh-token" \
  -d '{
    "startDate": "2023-06-01T00:00:00",
    "endDate": "2023-07-01T23:59:59",
    "clientUuids": null,
    "productsUuid": null,
    "domain": null
  }'
```

### Get 3D Views by Week

```bash
curl -X POST "https://api-platform.vntana.com/v2/metrics/views-data" \
  -H "Content-Type: application/json" \
  -H "x-auth-token: Bearer your-refresh-token" \
  -d '{
    "viewType": "3DView",
    "actionTypes": ["view"],
    "returnFields": ["device"],
    "startDate": "2023-01-01T00:00:00",
    "endDate": "2023-06-30T23:59:59",
    "dateInterval": "WEEK",
    "clientUuids": null,
    "productsUuid": null,
    "domain": null
  }'
```

### Get AR Views by Device

```bash
curl -X POST "https://api-platform.vntana.com/v2/metrics/views-data" \
  -H "Content-Type: application/json" \
  -H "x-auth-token: Bearer your-refresh-token" \
  -d '{
    "viewType": "ARView",
    "actionTypes": ["click", "scan"],
    "returnFields": ["device"],
    "startDate": "2023-01-01T00:00:00",
    "endDate": "2023-06-30T23:59:59",
    "dateInterval": "MONTH",
    "clientUuids": null,
    "productsUuid": null,
    "domain": null
  }'
```

### Download Summary Report

```bash
# Get the base64 encoded report
curl -X POST "https://api-platform.vntana.com/v2/metrics/summary-report" \
  -H "Content-Type: application/json" \
  -H "x-auth-token: Bearer your-refresh-token" \
  -d '{
    "startDate": "2023-01-01",
    "endDate": "2023-06-30",
    "clientUuids": null,
    "productUuids": null,
    "domain": null
  }' | jq -r '.response.document' | base64 -d > analytics-report.xlsx
```

## The Domain Parameter

Each endpoint has a `domain` request parameter that allows you to filter metrics returned by only those generated at a specific domain. However, for a metric capture to be tied to the domain it occurred at, the domain must be added to either the iFrame embed code or the share link.

**Key Points:**

- Only one domain can be added to the embed at a time
- You can have different domains in the same Asset's embed code on multiple sites
- Example: Use domain A in the embed code on site A, domain B in the same Asset's embed code on site B

This allows you to track which embedded viewers are generating the most engagement across different websites.

## Common Patterns

### Filter by Specific Workspace

To get metrics for a specific workspace only:

```json
{
  "startDate": "2023-01-01T00:00:00",
  "endDate": "2023-12-31T23:59:59",
  "clientUuids": ["workspace-uuid-here"],
  "productsUuid": null,
  "domain": null
}
```

### Filter by Multiple Assets

To get metrics for specific products:

```json
{
  "startDate": "2023-01-01T00:00:00",
  "endDate": "2023-12-31T23:59:59",
  "clientUuids": null,
  "productsUuid": ["product-uuid-1", "product-uuid-2", "product-uuid-3"],
  "domain": null
}
```

### Filter by Domain

To get metrics from a specific embedded domain:

```json
{
  "startDate": "2023-01-01T00:00:00",
  "endDate": "2023-12-31T23:59:59",
  "clientUuids": null,
  "productsUuid": null,
  "domain": "mywebsite.com"
}
```

## Error Handling

| Error | Cause | Solution |
|-------|-------|----------|
| `401 Unauthorized` | Invalid or expired token | Re-authenticate and get new refresh token |
| `403 Forbidden` | User lacks permission | Verify user has access to the workspace |
| `422 Unprocessable Entity` | Invalid date format or parameters | Check date formats and parameter types |

## Related

- [REST API Overview](../getting-started/rest-api-overview.md)
- [API Authentication](../authentication/api-authentication.md)
- [iFrames](../embedding/iframes.md)
- [Swagger Reference: Admin API](/api-documentation/swagger/vntana-admin-api-docs.yaml)
